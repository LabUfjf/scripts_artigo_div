function [fx] = kernel_fun_der(kernel,r)
syms x
if strcmp(kernel,'epanechnikov') && (r >= 3); disp('epanechnikov kernel derivative = 0 for order >= 3');end
if strcmp(kernel,'xniform') && (r >= 1);      disp('xniform kernel derivative = 0 for order >= 1');end
if strcmp(kernel,'triweight') && (r >= 7);    disp('triweight kernel derivative = 0 for order >= 7');end
if strcmp(kernel,'biweight') && (r >= 5);     disp('biweight kernel derivative = 0 for order >= 5');end
if strcmp(kernel,'triangxlar') && (r >= 2);   disp('triangxlar kernel derivative = 0 for order >= 2');end
if strcmp(kernel,'tricxbe') && (r >= 10);     disp('tricxbe kernel derivative = 0 for order >= 10'); end

switch kernel
    case 'Gaussian'
        K=(1/sqrt(2*pi))*exp(-((x.^2)/2)); %[-inf,inf]
    case 'Epanechnikov'
        K=(3/4)*(1-(x.^2));%[|x|<=1]
    case 'xniform'
        K=(1/2); %[|x|<=1]
    case 'Triangxlar'
        K=1-abs(x); %[|x|<=1]
    case 'Triweight'
        K=(35/32)*(1-(x.^2)).^3; %[|x|<=1]
    case 'Tricxbe'
        K=(70/81)*(1-abs(x.^3)); %[|x|<=1]
    case 'Biweight'
        K=(15/16)*(1-(x.^2)); %[|x|<=1]
    case 'Cosine'
        K=(pi/4)*cos((pi/2).*x); %[|x|<=1]
end


if strcmp(kernel,'Gaussian')
    if (r == 0); fx=K;
    elseif (r == 1);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)/sqrt(pi);
    elseif (r == 2);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^2-1)/sqrt(pi) ;
    elseif (r == 3);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^2-3)/sqrt(pi);
    elseif (r == 4);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^4-6*x^2+3)/sqrt(pi);
    elseif (r == 5);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^4-10*x^2+15)/sqrt(pi);
    elseif (r == 6);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^6-15*x^4+45*x^2-15)/sqrt(pi);
    elseif (r == 7);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^6-21*x^4+105*x^2-105)/sqrt(pi);
    elseif (r == 8);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^8-28*x^6+210*x^4-420*x^2+105)/sqrt(pi);
    elseif (r == 9);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^8-36*x^6+378*x^4-1260*x^2+945)/sqrt(pi);
    elseif (r == 10);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^10-45*x^8+630*x^6-3150*x^4+4725*x^2-945)/sqrt(pi);
    elseif (r == 11);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^10-55*x^8+990*x^6-6930*x^4+17325*x^2-10395)/sqrt(pi);
    elseif (r == 12);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^12-66*x^10+1485*x^8-13860*x^6+51975*x^4-62370*x^2+10395)/sqrt(pi);
    elseif (r == 13);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^12-78*x^10+2145*x^8-25740*x^6+135135*x^4-270270*x^2+135135)/sqrt(pi);
    elseif (r == 14);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^14-91*x^12+3003*x^10-45045*x^8+315315*x^6-945945*x^4+945945*x^2-135135)/sqrt(pi);
    elseif (r == 15);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^14-105*x^12+4095*x^10-75075*x^8+675675*x^6-2837835*x^4+4729725*x^2-2027025)/sqrt(pi);
    elseif (r == 16);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^16-120*x^14+5460*x^12-120120*x^10+1351350*x^8-7567560*x^6+18918900*x^4-16216200*x^2+2027025)/sqrt(pi);
    elseif (r == 17);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^16-136*x^14+7140*x^12-185640*x^10+2552550*x^8-18378360*x^6+64324260*x^4-91891800*x^2+34459425)/sqrt(pi);
    elseif (r == 18);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^18-153*x^16+9180*x^14-278460*x^12+4594590*x^10-41351310*x^8+192972780*x^6-413513100*x^4+310134825*x^2-34459425)/sqrt(pi);
    elseif (r == 19);fx = -(1/2)*x*exp(-(1/2)*x^2)*sqrt(2)*(x^18-171*x^16+11628*x^14-406980*x^12+7936110*x^10-87297210*x^8+523783260*x^6-1571349780*x^4+1964187225*x^2-654729075)/sqrt(pi);
    elseif (r == 20);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^20-190*x^18+14535*x^16-581400*x^14+13226850*x^12-174594420*x^10+1309458150*x^8-5237832600*x^6+9820936125*x^4-6547290750*x^2+654729075)/sqrt(pi);
    elseif (r == 21);fx = -(1/2)*exp(-(1/2)*x^2)*sqrt(2)*x*(x^20-210*x^18+17955*x^16-813960*x^14+21366450*x^12-333316620*x^10+3055402350*x^8-15713497800*x^6+41247931725*x^4-45831035250*x^2+13749310575)/sqrt(pi);
    elseif (r == 22);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^22-231*x^20+21945*x^18-1119195*x^16+33575850*x^14-611080470*x^12+6721885170*x^10-43212118950*x^8+151242416325*x^6-252070693875*x^4+151242416325*x^2-13749310575)/sqrt(pi);
    elseif (r == 23);fx = -(1/2)*exp(-(1/2)*x^2)*sqrt(2)*x*(x^22-253*x^20+26565*x^18-1514205*x^16+51482970*x^14-1081142370*x^12+14054850810*x^10-110430970650*x^8+496939367925*x^6-1159525191825*x^4+1159525191825*x^2-316234143225)/sqrt(pi);
    elseif (r == 24);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^24-276*x^22+31878*x^20-2018940*x^18+77224455*x^16-1853386920*x^14+28109701620*x^12-265034329560*x^10+1490818103775*x^8-4638100767300*x^6+6957151150950*x^4-3794809718700*x^2+316234143225)/sqrt(pi);
    elseif (r == 25);fx = -(1/2)*exp(-(1/2)*x^2)*sqrt(2)*x*(x^24-300*x^22+37950*x^20-2656500*x^18+113565375*x^16-3088978200*x^14+54057118500*x^12-602350749000*x^10+4141161399375*x^8-16564645597500*x^6+34785755754750*x^4-31623414322500*x^2+7905853580625)/sqrt(pi);
    elseif (r == 26);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^26-325*x^24+44850*x^22-3453450*x^20+164038875*x^18-5019589575*x^16+100391791500*x^14-1305093289500*x^12+10767019638375*x^10-53835098191875*x^8+150738274937250*x^6-205552193096250*x^4+102776096548125*x^2-7905853580625)/sqrt(pi);
    elseif (r == 27);fx = -(1/2)*exp(-(1/2)*x^2)*sqrt(2)*x*(x^26-351*x^24+52650*x^22-4440150*x^20+233107875*x^18-7972289325*x^16+180705224700*x^14-2710578370500*x^12+26428139112375*x^10-161505294575625*x^8+581419060472250*x^6-1109981842719750*x^4+924984868933125*x^2-213458046676875)/sqrt(pi);
    elseif (r == 28);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^28-378*x^26+61425*x^24-5651100*x^22+326351025*x^20-12401338950*x^18+316234143225*x^16-5421156741000*x^14+61665657928875*x^12-452214824811750*x^10+2034966711652875*x^8-5179915266025500*x^6+6474894082531875*x^4-2988412653476250*x^2+213458046676875)/sqrt(pi);
    elseif (r == 29);fx = -(1/2)*exp(-(1/2)*x^2)*sqrt(2)*x*(x^28-406*x^26+71253*x^24-7125300*x^22+450675225*x^20-18928359450*x^18+539458244325*x^16-10480903032600*x^14+137561852302875*x^12-1192202719958250*x^10+6557114959770375*x^8-21459648959248500*x^6+37554385678684875*x^4-28887988983603750*x^2+6190283353629375)/sqrt(pi);
    elseif (r == 30);fx = (1/2)*exp(-(1/2)*x^2)*sqrt(2)*(x^30-435*x^28+82215*x^26-8906625*x^24+614557125*x^22-28392539175*x^20+899097073875*x^18-19651693186125*x^16+294775397791875*x^14-2980506799895625*x^12+19671344879311125*x^10-80473683597181875*x^8+187771928393424375*x^6-216659917377028125*x^4+92854250304440625*x^2-6190283353629375)/sqrt(pi);
    elseif (r > 30); [H] = hermiteP(x,r); [K] = kernel_function(x,kernel,'syms'); fx = ((-1)^r)*H*K;
    end
end
%         elseif strcmp(kernel,'cosine');
% 		     if (r == 0)
% 			 if ((r == 1)
% 			 K = fxnction(X)( ((-1)^r/2^(r+2))*pi^(r+1)*cos(0.5*pi*X))* (X >= -1 & X <= 1);else
% 			 K = fxnction(X)(-((-1)^r/2^(r+2))*pi^(r+1)*cos(0.5*pi*X))* (X >= -1 & X <= 1);;else
% 			 if ((r%/%2)%%2==0)
% 			 K = fxnction(X)( ((-1)^r/2^(r+2))*pi^(r+1)*sin(0.5*pi*X))* (X >= -1 & X <= 1);else
% 			 K = fxnction(X)(-((-1)^r/2^(r+2))*pi^(r+1)*sin(0.5*pi*X))* (X >= -1 & X <= 1);;
%              fx = K(x);
%         elseif strcmp(kernel,'tricxbe')
%              if (r == 1)fx = (x < 0 & x >= -1) *((70/9)*(x^3+1)^2*x^2)+ (x >= 0 & x <= 1)*(-(70/9)*(x^3-1)^2*x^2);
% 		     elseif (r == 2)fx = (x < 0 & x >= -1) *((560/9)*x^7+(700/9)*x^4+(140/9)*x)+ (x >= 0 & x <= 1)*(-(560/9)*x^7+(700/9)*x^4-(140/9)*x);
% 		     elseif (r == 3)fx = (x < 0 & x >= -1) *((3920/9)*x^6+(2800/9)*x^3+(140/9))+ (x >= 0 & x <= 1)*(-(3920/9)*x^6+(2800/9)*x^3-(140/9));
% 		     elseif (r == 4)fx = (x < 0 & x >= -1) *((7840/3)*x^5+(2800/3)*x^2)+ (x >= 0 & x <= 1)*(-(7840/3)*x^5+(2800/3)*x^2);
% 		     elseif (r == 5)fx = (x < 0 & x >= -1) *((39200/3)*x^4+(5600/3)*x)+ (x >= 0 & x <= 1)*(-(39200/3)*x^4+(5600/3)*x);
% 		     elseif (r == 6)fx = (x < 0 & x >= -1) *((156800/3)*x^3+(5600/3))+ (x >= 0 & x <= 1)*(-(156800/3)*x^3+(5600/3));
% 		     elseif (r == 7)fx = (x <0 & x >= -1) *(156800*x^2)+ (x >= 0 & x <= 1)*(-156800*x^2);
% 		     elseif (r == 8)fx = (x < 0 & x >= -1) *(313600*x)+ (x >= 0 & x <= 1)*( -313600*x);
% 		     elseif (r == 9)fx = (x < 0 & x >= -1) *(313600)+ (x >= 0 & x <= 1)*( -313600);;
%         elseif strcmp(kernel,'triweight')
%              if (r == 1)fx = (-(105/16)*(x^2-1)^2*x)*(x >= -1 & x <= 1);
% 		     elseif (r == 2)fx = (-(525/16)*x^4+(315/8)*x^2-(105/16))*(x >= -1 & x <= 1);
% 		     elseif (r == 3)fx = (-(525/4)*x^3+(315/4)*x)*(x >= -1 & x <= 1);
% 		     elseif (r == 4)fx = (-(1575/4)*x^2+(315/4))*(x >= -1 & x <= 1);
% 		     elseif (r == 5)fx = (-(1575/2)*x)*(x >= -1 & x <= 1);
% 		     elseif (r == 6)fx = (-1575/2)*(x >= -1 & x <= 1);;
%         elseif strcmp(kernel,'biweight')
%              if (r == 1)fx = (((15/4)*(x^2-1))*x)*(x >= -1 & x <= 1);
% 		     elseif (r == 2)fx = ((45/4)*x^2-(15/4))*(x >= -1 & x <= 1);
% 		     elseif (r == 3)fx = ((45/2)*x)*(x >= -1 & x <= 1);
% 		     elseif (r == 4)fx = (45/2)*(x >= -1 & x <= 1);;
%         elseif (kernel =='triangxlar')
%              if (r == 1)fx = (x <= 0 & x >= -1) - (x >= 0 & x <= 1);;
%         elseif strcmp(kernel,'epanechnikov')
%              if (r == 1)fx = (-(3/2)*x)*(x >= -1 & x <= 1);
% 		     elseif (r == 2)fx = (-3/2)*(x >= -1 & x <= 1);;
%         elseif strcmp(kernel,'silverman')
%              if (r == 1)fx = (x < 0)*((1/4)*sqrt(2)*exp((1/2)*x*sqrt(2))*(sin(-(1/2)*x*sqrt(2)+(1/4)*pi)-cos(-(1/2)*x*sqrt(2)+(1/4)*pi)))+ (x >= 0)* (-(1/4)*sqrt(2)*exp(-(1/2)*x*sqrt(2))*(sin((1/2)*x*sqrt(2)+(1/4)*pi)-cos((1/2)*x*sqrt(2)+(1/4)*pi)));
% 		     elseif (r == 2)fx = (x < 0)*(-(1/2)*exp((1/2)*x*sqrt(2))*cos(-(1/2)*x*sqrt(2)+(1/4)*pi))+ (x >= 0)* (-(1/2)*exp(-(1/2)*x*sqrt(2))*cos((1/2)*x*sqrt(2)+(1/4)*pi));
% 		     elseif (r == 3)fx = (x < 0)*(-(1/4)*exp((1/2)*x*sqrt(2))*sqrt(2)*(cos(-(1/2)*x*sqrt(2)+(1/4)*pi)+sin(-(1/2)*x*sqrt(2)+(1/4)*pi)))+ (x >= 0)* ((1/4)*exp(-(1/2)*x*sqrt(2))*sqrt(2)*(cos((1/2)*x*sqrt(2)+(1/4)*pi)+sin((1/2)*x*sqrt(2)+(1/4)*pi)));
% 		     elseif (r == 4)fx = (x < 0)*(-(1/2)*exp((1/2)*x*sqrt(2))*sin(-(1/2)*x*sqrt(2)+(1/4)*pi))+ (x >= 0)* (-(1/2)*exp(-(1/2)*x*sqrt(2))*sin((1/2)*x*sqrt(2)+(1/4)*pi));
% 		     elseif (r == 5)fx = (x < 0)*(-(1/4)*sqrt(2)*exp((1/2)*x*sqrt(2))*(sin(-(1/2)*x*sqrt(2)+(1/4)*pi)-cos(-(1/2)*x*sqrt(2)+(1/4)*pi)))+ (x >= 0)* ((1/4)*sqrt(2)*exp(-(1/2)*x*sqrt(2))*(sin((1/2)*x*sqrt(2)+(1/4)*pi)-cos((1/2)*x*sqrt(2)+(1/4)*pi)));
% 		     elseif (r == 6)fx = (x < 0)*((1/2)*exp((1/2)*x*sqrt(2))*cos(-(1/2)*x*sqrt(2)+(1/4)*pi))+ (x >= 0)* ((1/2)*exp(-(1/2)*x*sqrt(2))*cos((1/2)*x*sqrt(2)+(1/4)*pi));
% 		     elseif (r == 7)fx = (x < 0)*((1/4)*exp((1/2)*x*sqrt(2))*sqrt(2)*(cos(-(1/2)*x*sqrt(2)+(1/4)*pi)+sin(-(1/2)*x*sqrt(2)+(1/4)*pi)))+ (x >= 0)* (-(1/4)*exp(-(1/2)*x*sqrt(2))*sqrt(2)*(cos((1/2)*x*sqrt(2)+(1/4)*pi)+sin((1/2)*x*sqrt(2)+(1/4)*pi)));;


